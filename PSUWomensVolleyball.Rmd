---
title: "PSU Womens Volleyball"
author: "Lily Mayer, Ayla Orona, Kate Miller"
date: "2023-11-29"
output: html_document
---
## Introduction

The following document aims to provide details on Penn State Women's Volleyball data.

## The General Rules of Collegiate Volleyball


## Volleyball Terms Used in This Document

The following column headings were collected from the Penn State Women's Volleyball website and may be used in the data frames, tables, and visualizations. Each are based on individual volleyball players.

Player - Penn State Women's Volleyball player first and last name
SP - Total number of sets played
MP - Total number of matches played
MS - Total number of matches where the player started
PTS - Total points earned for the 2023 season
PTS/S - Average number of points earned per sets played
K - Total number of kills ****
K/S - Average number of kills executed per sets played
E - Total number of errors
TA - Total attacks ***
PCT - Attack percentage ***
A - Total number of assists where the player threw the ball to a teammate who then won the point
A/S - Average number of assists per sets played
SA - Total number of service aces, an ace means the serving team won the point before the recieving team could return the ball over the net
SA/S - Average number of service aces per sets played
SE - Total number of service errors, meaning the serve did not throw the ball over the net or threw it out of bounds

The following are the different positions on the volleyball team, which may be referenced in a data visualization or table.

MB - 
L - 
DS - 
OH - 
S - 
RS - 

Some players have more than one position. In these cases, the player's data will be included twice, once for each position, for comparisons that relate to the player's position. 


All code should be written according to a Style Guide of your choice. List this Style Guide as a code comment in your first code chunk.
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
# List Style Guide in this code chunk
#BOAST STYLE GUIDE OR GOOGLE'S R GUIDE
library(rvest)
library(ggplot2)
library(knitr)
library(kableExtra)
library(stringr)
library(tidyr)
library(pdftools)
library(tidyverse)
library(esquisse)
library(janitor)
```

```{r PSURosterTable}
psuVBRoster <- read_html(
  x = "https://gopsusports.com/sports/womens-volleyball/roster"
) %>%
  html_elements(css = "table") %>%
  html_table()
psuVBRoster <- bind_cols(psuVBRoster[[3]])
#saves correct data frame from harvest

psuVBRoster <- psuVBRoster %>%
  tidyr::separate_wider_delim(
    cols = `Ht.`,
    delim = '-',
    names = c('Feet', 'Inches')
  ) %>%
  #separates height column into feet and inches columns
  mutate_at(vars('Feet', 'Inches'), as.numeric) %>%
  #turns feet and inches into numeric types
  mutate('Height (in.)' = Inches + (Feet * 12)) %>%
  #creates a height column in inches
  select('#', 'Full Name', 'Pos.', 'Elig.', 'Height (in.)', 'Hometown / High School')
#reorders column and removes feet and inches columns

```

```{r PSURosterStatsTable}
psuRosterStats <- read_html(
  x = 'https://gopsusports.com/sports/womens-volleyball/stats'
) %>%
  html_elements(css = 'table') %>%
  html_table()
#harvests the player data from the gopsusports website

psuRosterOffensiveHeading <- bind_cols(psuRosterStats[[2]][1, ])
#saves the column headers as a single row

psuRosterOffensiveStats <- bind_cols(psuRosterStats[[2]][2:nrow(psuRosterStats[[2]]) , ])
#saves the rest of the player data as a dataframe


View(psuRosterOffensiveStats)
colnames(psuRosterOffensiveStats) <- c(psuRosterOffensiveHeading[1, ])
#inserts column headers into player data

psuOffensive <- psuRosterOffensiveStats %>%
  select(!contains('Link'))
#removes the 'Bio Link' column

psuOffensive <- psuOffensive[1:17, ]
#removes the 'Total' and 'Opponent' rows

psuOffensive$Player <- str_sub(psuOffensive$Player, end = -25)
#removes the repeated names from the player column

psuOffensive <- psuOffensive %>%
  tidyr::separate_wider_delim(
    cols = Player,
    delim = ',',
    names = c('Last', 'First')
  ) %>%
  #Separates the player names into separate columns for first and last name
  mutate(
    'Player' = paste(First, Last, sep = ' '), 
    .before = First
  ) %>%
  #concatenates the first and last names together
  mutate(
    `Player` = stringr::str_squish(`Player`)) %>%
  select(!'First') %>%
  select(!'Last')
  #removes excess whitespace and removes individual name columns

psuOffensive <- psuOffensive %>%
  mutate_at(vars(!Player), as.numeric)
#turns all columns except Player into numeric types

psuOffensiveRoster <- inner_join(
  x = psuOffensive, 
  y = psuVBRoster, 
  by = join_by('Player' == 'Full Name', '#' == '#')
)
#joins the roster data into the offensive statistics

psuSepPos <- separate_longer_delim(psuOffensiveRoster, 'Pos.', delim = '/')
#creates a second row for players with two positions so each row has only one position

```

```{r OSURosterStatsTable}
url <- c('https://s3.us-east-2.amazonaws.com/sidearm.nextgen.sites/ohiostatebuckeyes.com/stats/wvb/2023/pdf/cume.pdf')
raw_text <- pdf_text(url)

#the following code was found on the internet to harvest the osu data from a pdf
clean_table <- function(raw) {
  raw <- map(raw, ~ str_split(.x, '\\n') %>% unlist())
  raw <- reduce(raw, c)
  
  table_start <- stringr::str_which(tolower(raw), '#')
  table_end <- stringr::str_which(tolower(raw), '31')
  table_end <- table_end[min(which(table_end > table_start))]
  
  table <- raw[(table_start):(table_end)]
  table <- str_replace_all(table, '\\s{2,}', '|')
  text_con <- textConnection(table)
  data_table <- read.csv(text_con, sep = '|')
  
  data_table
}
osuRawStats <- map_df(raw_text, clean_table)
#the osu data is very dirty, with some columns holding data from more than one column

osuFixOne <- osuRawStats[1, ] %>%
  #the first row has the name and 'SP' in the 'Player' column
  mutate('missing' = paste(Player))
#creates a new column to duplicate the broken cell
osuFixOne$missing <- str_sub(osuFixOne$missing, start = 22)
#removes the name and leaves just the number
osuFixOne$Player <- str_sub(osuFixOne$Player, end = -4)
#removes the number and leaves just the name
osuFixOne <- osuFixOne %>%
  select(!'PTS')
#removes the 'PTS' column
colnames(osuFixOne) <- c('#', 'Player', 'K', 'K.S', 'E', 'TA', 'Pct', 'A', 'A.S', 'SA', 'SE', 'SA.S', 'RE', 'DIG', 'DIG.S', 'BS', 'BA', 'BLK', 'BLK.S', 'BE', 'BHE', 'PTS', 'SP')
#shifts the column headers to reflect the correct data
osuFixOne <- osuFixOne %>%
  select('#', 'Player', 'SP', 'K', 'K.S', 'E', 'TA', 'Pct', 'A', 'A.S', 'SA', 'SE', 'SA.S', 'RE', 'DIG', 'DIG.S', 'BS', 'BA', 'BLK', 'BLK.S', 'BE', 'BHE', 'PTS')
#changes the order of the columns to the original order

osuFixOthers <- osuRawStats[7:12, ] %>%
#rows 7 to 12 include both player number and name in the 'X.' column
  mutate('missing' = paste(X.))
#copies the broken cell into a new column
osuFixOthers$missing <- str_sub(osuFixOthers$missing, start = 4)
#removes the number
osuFixOthers$X. <- str_sub(osuFixOthers$X., end = 3)
#removes the name
osuFixOthers <- osuFixOthers %>%
  select(!'PTS')
#removes the 'PTS' column
colnames(osuFixOthers) <- c('#', 'SP', 'K', 'K.S', 'E', 'TA', 'Pct', 'A', 'A.S', 'SA', 'SE', 'SA.S', 'RE', 'DIG', 'DIG.S', 'BS', 'BA', 'BLK', 'BLK.S', 'BE', 'BHE', 'PTS', 'Player')
#shifts the column names to reflect the correct data


osuGoodRows <- osuRawStats[2:6, ] %>%
  #selects the rows which were formatted correctly
  rename('#' = 'X.')
#changes the name of the player number column

osuStats <- rbind(osuFixOne, osuGoodRows, osuFixOthers)
#vertically joins the osu data back together

osuStats <- osuStats %>%
  tidyr::separate_wider_delim(
    cols = Player,
    delim = ',',
    names = c('Last', 'First')
  ) %>%
  #Separates the player names into separate columns for first and last name
  mutate(
    'Player' = paste(First, Last, sep = ' '), 
    .before = First
  ) %>%
  #concatenates the first and last names together
  mutate(
    `Player` = stringr::str_squish(`Player`)) %>%
  select(!'First') %>%
  select(!'Last') %>%
  #removes the first and last name columns
  mutate_at(vars(!Player), as.numeric)
#saves all columns except for Player as a numeric type

osuJoin <- osuStats %>%
  select('#', 'Player', 'SP', 'K', 'K.S', 'E', 'TA', 'Pct', 'A', 'A.S', 'SA', 'SE', 'SA.S', 'PTS') %>%
  #selects the columns which are in common with the psu data
  mutate('School' = 'OSU')
#adds a column to save the school of each player
colnames(osuJoin) <- c('#', 'Player', 'SP', 'K', 'K/S', 'E', 'TA', 'PCT', 'A', 'A/S', 'SA', 'SE', 'SA/S', 'PTS', 'School')
#changes the names of the columns to match the psu data

psuJoin <- psuOffensive %>%
  select('#', 'Player', 'SP', 'K', 'K/S', 'E', 'TA', 'PCT', 'A', 'A/S', 'SA', 'SE', 'SA/S', 'PTS') %>%
  #selects the columns which are in common with the osu data
  mutate('School' = 'PSU')
#adds a column to save the school of each player
  
psuAndOsu <- rbind(psuJoin, osuJoin)
#vertically joins the psu and osu data together

```


Average sets per year in terms of school year (bar chart)
Summary Table: Average of specific stats for each position

```{r averageSetsPlayedPerSchoolYearDataTable}
setsSummaryTable <- psuOffensiveRoster %>%
  # Creates a summary table based on the wrangled and tidied data
  # from the previous code chunk.
  group_by(Elig.) %>%
  # We are grouping by eligibility (grade), meaning that the summary
  # statistics will be given for each grade.
  summarize(
  count = n(),
  minimum = min(SP),
  # Since we are looking specificially at the data for sets played, we select
  # the variable "SP" for all the statistics.
  firstQuintile = quantile(SP, 0.25),
  median = median(SP),
  thirdQuintile = quantile(SP, 0.75),
  maximum = max(SP),
  mean = mean(SP),
  standardDeviation = sd(SP)
    )

setsSummaryTable2 <- setsSummaryTable %>%
  mutate(
    across(where(is.numeric), round, 2)
    )
  # This section utilizes the mutate function to round any variable that
  # is a number to 2 decimal places.

setsSummaryTable2 %>%
  kable(
  col.names = c("Grade","Count", "Minimum", "First Quartile", "Median", "Third Quartile", "Maximum", "Arithmetic Mean", "Arithmetic Standard Deviation"),
  # Changes the column names to those listed above.
  caption = "Summary Statistics of Average Sets Played Per Grade",
  # Changes the title of the summary table.
  booktabs = TRUE,
  align = c("l", rep("c", 6))
  ) %>%
  kableExtra::kable_classic()
  # This section utilizes the kableExtra package to create a clear summary
  # table for the viewer to look at.

View(setsSummaryTable2)
# Mutate function, freshman is first year, etc. 
```
The summary table shown above provides the 5 number summary statistics for number of sets played based on grade (year in school). It also displays the amount of players in each grade, as well as the mean and standard deviation for the number of sets played in each grade. From the summary table, we can see that the freshman had the lowest number of sets played, at 2 sets. The sophomores and seniors had the same maximum number of sets played at 116, though the seniors had a higher mean of total sets played. We can also see that the seniors have the greatest number of starters.

```{r renamingEligibilityRows}



```

```{r averageSetsPlayedPerSchoolYearDataVisualization}

ggplot(setsSummaryTable2) +
  # Utilizes ggplot to create a data visualization based on the 
  # summary table created previously.
  aes(x = Elig., y = mean, group = count) +
  # Elig. (grade) will be on the horizontal axis, mean will be on the 
  # vertical axis, and the data will overall be grouped by count.
  geom_col(fill = "#3F567E") +
  # geom_col will display a bar chart.
  labs(
    x = "Player Grade (Year)",
    y = "Mean Sets Played",
    title = "Penn State Women's Volleyball Average Number of Sets Played Per Grade (2023 Season)"
  # Sets the axes and title of the data visualization.
  ) +
  theme_minimal()

```
From this data visualization, the viewer can see that the mean number of sets played was lowest for the freshman compared to the other class groups. The mean number of sets played was highest for the seniors, meaning that on average, the seniors played the most sets overall. An important item to note is that the mean number of sets played is higher for the sophomores than it is for the juniors, even though the juniors are older. In this case, the juniors don't play as much as the sophomores, on average, showing that the volleyball team does not choose who plays based on seniority.

```{r averageStatsPerPositionSummaryTable}

setsSummaryTable <- psuOffensiveRoster %>%
  # Creates a summary table based on the wrangled and tidied data with object
  # name "psuOffensive" from a previous code chunk.
  group_by(Pos.) %>%
  # We are grouping by position, meaning that the summary
  # statistics will be given for each grade.
  summarize(
  count = n(),
  minimum = min(SP),
  firstQuintile = quantile(SP, 0.25),
  median = median(SP),
  thirdQuintile = quantile(SP, 0.75),
  maximum = max(SP),
  mean = mean(SP),
  standardDeviation = sd(SP)
    )

setsSummaryTable2 <- setsSummaryTable %>%
  mutate(
    across(where(is.numeric), round, 2)
    )
  # This section utilizes the mutate function to round any variable that
  # is a number to 2 decimal places.

setsSummaryTable2 %>%
  kable(
  col.names = c("Position","Count", "Minimum", "First Quartile", "Median", "Third Quartile", "Maximum", "Arithmetic Mean", "Arithmetic Standard Deviation"),
  # Changes the column names to those listed above.
  caption = "Summary Statistics of Average Sets Played Per Grade",
  # Changes the title of the summary table.
  booktabs = TRUE,
  align = c("l", rep("c", 6))
  ) %>%
  kableExtra::kable_classic()
  # This section utilizes the kableExtra package to create a clear summary
  # table for the viewer to look at.

View(setsSummaryTable2)

```

## Research Questions

based on summary table of PSU team and visualizations

## Read in data and perform necessary wrangling and cleaning
Describe your data sources (where they come from, what was their original purpose, who/what comprise the cases in each).
Notes:
- PSU V. Ohio State Portion: We gathered both the Penn state's and Ohio State's women volleyball team stats. We googled each roster of both teams and merged them together. The PSU stat table did not have the position of each player, so to match each player with their position, we joined a PSU Roster that contained players and their position with the PSU Stat table. We then compared Penn state and Ohio State's stats.

- Only PSU Portion: We googled the roster and stats of the Penn state's women volleyball team. Because the PSU stat roster did not have the position of each player, we merged the stats table with the team roster containing players position. We then compared data within the PSU team.

Describe what attributes you'll focus your analysis on (mention if they are part of your data sets or if you created them out of your data sets).

-service ace per set vs service error per set. To get rate of errors: SE column divided by SP column.
- Visualizations: stats of each year for each player(bar chart, histogram), PSU v. OSU, etc.

## Conduct Exploratory Data Analysis
- points vs. height (scatter)- Ayla
```{r PointsVHeight, echo = FALSE}

ggplot(psuOffensiveRoster) +
  aes(x = `Height (in.)`, y = PTS) +
  geom_point(shape = "circle", size = 1.8, colour = "#005BAC") +
  labs(
    x = "Height (in.)",
    y = "Points",
    title = "Total Points Vs. Player Height"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16L),
    axis.title.y = element_text(size = 13L),
    axis.title.x = element_text(size = 13L)
  )

```
The visualization shown above is the comparison of each players height versus their total amount of points for this season. As seen in the graph, the player that has scored the most amount of points this season is 73 in (6'2 ft) with points ranging in the 500s. The players with the most amount of points range from 73 in (6'2 ft) to 75 in (6'4 ft)....

- average sets per year in terms of school year(bar chart)- Kate
- Summary Table: average of specific stats for each position- Kate


All outputs should be accompanied by narrative text to explain what the reader should be seeing.

Create multiple data visualizations that assist both the team and readers in understanding the data.
Data visualizations should show a variety of your skills and geometries.

Create at least one visual table (not a display of raw data) that assists both the team and readers in understanding the data.

Have narrative text explaining every data visualization and table as well as setting a framework.

